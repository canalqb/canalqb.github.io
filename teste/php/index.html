<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>PHP WASM - Exemplo básico</title>
  <style>
    body { font-family: monospace; padding: 1rem; background: #222; color: #eee; }
    pre { background: #111; padding: 1rem; border-radius: 6px; white-space: pre-wrap; }
  </style>
</head>
<body>
  <h1>Executando PHP WASM - Versão do PHP</h1>
  <pre id="output">Carregando...</pre>

  <script type="module">
    import { PhpWeb } from 'https://cdn.jsdelivr.net/npm/php-wasm@0.0.9-alpha-20/PhpWeb.mjs';

    async function main() {
      const output = document.getElementById('output');
      output.textContent = 'Inicializando PHP WASM...\n';

      const php = new PhpWeb();

      php.addEventListener('output', e => {
        output.textContent += e.detail;
      });

      php.addEventListener('error', e => {
        output.textContent += 'Erro: ' + e.detail + '\n';
      });

      // Busca o arquivo PHP no servidor real, dentro da pasta phps
      const response = await fetch('phps/infophp.php');
      if (!response.ok) {
        output.textContent += `Erro ao carregar infophp.php: ${response.statusText}`;
        return;
      }
      const phpCode = await response.text();

      // Espera o PHP WASM ficar pronto antes de manipular o FS virtual
      php.addEventListener('ready', async () => {
        output.textContent += 'PHP WASM está pronto.\n';

        try {
          // Grava o arquivo no FS virtual
          php.FS.writeFile('/infophp.php', phpCode);
          output.textContent += 'Arquivo PHP gravado no FS virtual.\nExecutando...\n\n';

          // Executa o arquivo PHP pelo caminho no FS virtual
          await php.run(['/infophp.php']);

          output.textContent += '\nExecução finalizada.';
        } catch (err) {
          output.textContent += 'Erro fatal: ' + err.message + '\n';
          console.error(err);
        }
      });
    }

    main();
  </script>
</body>
</html>
