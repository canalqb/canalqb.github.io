<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>PHP WASM - Exemplo básico</title>
  <style>
    body { font-family: monospace; padding: 1rem; background: #222; color: #eee; }
    pre { background: #111; padding: 1rem; border-radius: 6px; white-space: pre-wrap; }
  </style>
</head>
<body>
  <h1>Executando PHP WASM - Versão do PHP</h1>
  <pre id="output">Carregando...</pre>

  <script type="module">
    import { PhpWeb } from 'https://cdn.jsdelivr.net/npm/php-wasm@0.0.9-alpha-20/PhpWeb.mjs';

    async function main() {
      const output = document.getElementById('output');
      output.textContent = 'Inicializando PHP WASM...\n';

      const php = new PhpWeb();

      php.addEventListener('output', e => {
        output.textContent += e.detail;
      });

      php.addEventListener('error', e => {
        output.textContent += 'Erro: ' + e.detail + '\n';
      });

      // 1. Buscar o arquivo PHP no servidor real, dentro da pasta phps
      const response = await fetch('phps/infophp.php');
      if (!response.ok) {
        output.textContent += `Erro ao carregar infophp.php: ${response.statusText}`;
        return;
      }
      const phpCode = await response.text();

      // 2. Montar o arquivo dentro do sistema de arquivos virtual, na mesma pasta '/phps'
      await php.mount({
        '/phps': {
          'infophp.php': phpCode
        }
      });

      output.textContent += 'Arquivo PHP montado no FS virtual.\nExecutando...\n\n';

      // 3. Executar o arquivo pelo caminho no FS virtual (igual ao montado)
      await php.run(['/phps/infophp.php']);

      output.textContent += '\nExecução finalizada.';
    }

    main();
  </script>
</body>
</html>
