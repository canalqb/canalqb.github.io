<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>PHP WASM - Exemplo básico</title>
  <style>
    body { font-family: monospace; padding: 1rem; background: #222; color: #eee; }
    pre { background: #111; padding: 1rem; border-radius: 6px; }
  </style>
</head>
<body>
  <h1>Executando PHP WASM - Versão do PHP</h1>
  <pre id="output">Carregando...</pre>

  <script type="module">
    import { PhpWeb } from 'https://cdn.jsdelivr.net/npm/php-wasm@0.0.9-alpha-20/PhpWeb.mjs';

    async function main() {
      const output = document.getElementById('output');
      output.textContent = 'Inicializando PHP WASM...\n';

      const php = new PhpWeb();

      php.addEventListener('output', e => {
        output.textContent += e.detail;
      });

      php.addEventListener('error', e => {
        output.textContent += 'Erro: ' + e.detail + '\n';
      });

      // Busca o arquivo PHP da pasta phps
      const response = await fetch('phps/infophp.php');
      if (!response.ok) {
        output.textContent += `Erro ao carregar infophp.php: ${response.statusText}`;
        return;
      }
      const phpCode = await response.text();

      // Grava o arquivo no FS virtual do PHP WASM
      await php.FS.writeFile('/infophp.php', phpCode);

      output.textContent += 'Arquivo PHP carregado no FS virtual.\nExecutando...\n\n';

      // Executa o script PHP pelo caminho no FS virtual
      await php.run(['/infophp.php']);
    }

    main();
  </script>
</body>
</html>
